<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Green Earth - Plant a Tree</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .active-category {
      background-color: #166534;
      color: #fff;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #166534;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .category-badge {
      background-color: #dcfce7;
      color: #166534;
      font-size: 12px;
      font-weight: 500;
      padding: 4px 12px;
      border-radius: 9999px;
      display: inline-block;
      white-space: nowrap;
    }
    #tree-modal { z-index: 60; }
  </style>
</head>
<body class="font-sans bg-green-50">

  <!-- Navbar -->
  <nav class="flex justify-between items-center px-6 py-4 bg-green-900 text-white sticky top-0 z-50">
    <div class="font-bold text-xl">ðŸŒ± Green Earth</div>
    <!-- Desktop Menu -->
    <ul class="hidden md:flex space-x-8">
      <li><a href="#about" class="hover:text-yellow-400">About</a></li>
      <li><a href="#impact" class="hover:text-yellow-400">Gallery</a></li>
      <li><a href="#form" class="hover:text-yellow-400">Plant a Tree</a></li>
    </ul>
    <!-- Mobile Hamburger -->
    <button id="menu-btn" class="md:hidden text-2xl">â˜°</button>
    <button class="hidden md:block bg-yellow-400 text-green-900 px-5 py-2 rounded-full font-semibold hover:bg-yellow-500">
      Plant a Tree
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden flex-col bg-green-800 text-white px-6 py-4 space-y-3 md:hidden">
    <a href="#about" class="hover:text-yellow-400">About</a>
    <a href="#impact" class="hover:text-yellow-400">Gallery</a>
    <a href="#form" class="hover:text-yellow-400">Plant a Tree</a>
  </div>
<!-- Banner -->
<section class="relative bg-green-100 py-16 px-6 text-center overflow-hidden">
  <!-- Left leaf -->
  <img src="assets/hero-leaf1.png"
       alt="Leaf Left"
       class="absolute left-0 top-1/2 -translate-y-1/2 h-56 md:h-72">

  <!-- Right leaf -->
  <img src="assets/hero-leaf2.png"
       alt="Leaf Right"
       class="absolute right-0 top-1/2 -translate-y-1/2 h-56 md:h-72">

  <!-- Content -->
  <div class="relative z-10 max-w-2xl mx-auto">
    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
      Plant a Tree, Grow a Future
    </h1>
    <p class="text-gray-700 mb-6">
      Join our mission to plant 1 million trees and make the Earth greener for future generations.
    </p>
    <button class="bg-yellow-400 hover:bg-yellow-500 px-6 py-2 rounded-full font-semibold text-black">
      Get Involved
    </button>
  </div>
</section>

  <!-- Categories + Trees + Cart -->
  <section class="px-6 py-12 bg-green-50">
    <h2 class="text-2xl font-bold text-center mb-8">Choose Your Trees</h2>

    <div class="grid md:grid-cols-4 gap-6 max-w-7xl mx-auto">

      <!-- Categories -->
      <div>
        <h3 class="font-semibold mb-4">Categories</h3>
        <div id="categories" class="flex flex-col gap-2">
          <div class="spinner"></div>
        </div>
      </div>

      <!-- Trees -->
      <div class="md:col-span-2">
        <div id="tree-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="col-span-full flex justify-center py-6"><div class="spinner"></div></div>
        </div>
      </div>

      <!-- Cart -->
      <div>
        <h3 class="font-semibold mb-4">Your Cart</h3>
        <ul id="cart-list" class="space-y-2 min-h-[120px]"></ul>
        <div class="mt-4 p-3 bg-white rounded shadow">
          <p class="font-bold">Total: à§³<span id="cart-total">0</span></p>
        </div>
      </div>
    </div>
  </section>

  <!-- About -->
  <section id="about" class="py-10 bg-green-50">
    <div class="max-w-5xl mx-auto px-6">
      <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">About the Campaign</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
        <div class="flex justify-center">
          <img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=" alt="About Campaign" class="rounded-lg shadow-md max-w-sm w-full h-auto">
        </div>
        <div class="max-w-md">
          <p class="text-gray-600 mb-4 text-justify">
            Green Earth is a global tree plantation initiative dedicated to fighting climate change.
            By joining our campaign, you help restore forests, create habitats for wildlife, and combat global warming.
          </p>
          <ul class="list-disc pl-5 text-gray-700 space-y-1 text-sm">
            <li>Restoration of natural habitats</li>
            <li>Improvement of air quality</li>
            <li>Support for local communities</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Our Impact -->
  <section id="impact" class="py-12 bg-green-100">
    <div class="max-w-6xl mx-auto px-6">
      <h2 class="text-2xl font-bold text-center text-gray-800 mb-10">Our Impact</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-2xl font-bold text-green-700 mb-1">500K+</h3>
          <p class="text-sm text-gray-600">Trees Planted</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-2xl font-bold text-green-700 mb-1">120+</h3>
          <p class="text-sm text-gray-600">Communities Involved</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-2xl font-bold text-green-700 mb-1">30+</h3>
          <p class="text-sm text-gray-600">Countries Reached</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Form -->
  <section id="form" class="px-6 py-12 bg-green-900 text-white text-center">
    <h2 class="text-2xl font-bold mb-6">Plant a Tree Today</h2>
    <form id="donation-form" class="max-w-md mx-auto bg-green-800 p-6 rounded-lg space-y-4" onsubmit="event.preventDefault(); alert('Thank you!')">
      <input id="donor-name" type="text" placeholder="Your Name" class="w-full p-2 rounded text-black" required>
      <input id="donor-email" type="email" placeholder="Your Email Address" class="w-full p-2 rounded text-black" required>
      <input id="donor-number" type="number" placeholder="Number of Trees" class="w-full p-2 rounded text-black" required>
      <button class="bg-yellow-400 text-green-900 px-6 py-2 rounded-full font-semibold w-full hover:bg-yellow-500">Donate Now</button>
    </form>
  </section>

  <!-- Footer -->
  <footer class="bg-green-950 text-white text-center py-4">
    Â© 2025 Green Earth. All Rights Reserved.
  </footer>

  <!-- Modal -->
  <div id="tree-modal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
    <div class="bg-white p-6 rounded-lg max-w-2xl w-full">
      <h2 id="modal-title" class="text-xl font-bold mb-2"></h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="md:col-span-1 flex items-center justify-center">
          <img id="modal-img" src="" alt="" class="max-h-48 object-cover rounded" />
        </div>
        <div class="md:col-span-2">
          <p id="modal-desc" class="mb-4 text-gray-700"></p>
          <p class="font-bold">Price: à§³<span id="modal-price"></span></p>
          <p class="text-sm text-gray-600 mt-2" id="modal-category"></p>
        </div>
      </div>
      <div class="mt-4 flex gap-2 justify-end">
        <button onclick="closeModal()" class="bg-gray-200 px-4 py-2 rounded">Close</button>
      </div>
    </div>
  </div>

<script>
  // Mobile menu toggle
  document.getElementById("menu-btn").addEventListener("click", () => {
    document.getElementById("mobile-menu").classList.toggle("hidden");
  });

  // --- ELEMENTS ---
  const categoriesDiv = document.getElementById("categories");
  const treeList = document.getElementById("tree-list");
  const cartList = document.getElementById("cart-list");
  const cartTotal = document.getElementById("cart-total");
  const modal = document.getElementById("tree-modal");
  const modalTitle = document.getElementById("modal-title");
  const modalDesc = document.getElementById("modal-desc");
  const modalPrice = document.getElementById("modal-price");
  const modalImg = document.getElementById("modal-img");
  const modalCategory = document.getElementById("modal-category");

  let activeCategoryId = null;
  let activeCategoryButton = null;
  let cart = [];
  const PLACEHOLDER_IMG = "https://via.placeholder.com/600x400?text=No+Image";

  function safeGetPlantsFromResponse(res) {
    if (!res) return [];
    if (Array.isArray(res)) return res;
    if (res.plants && Array.isArray(res.plants)) return res.plants;
    if (res.data && Array.isArray(res.data)) return res.data;
    if (res.data && res.data.plants && Array.isArray(res.data.plants)) return res.data.plants;
    for (const k of Object.keys(res)) {
      if (Array.isArray(res[k])) return res[k];
    }
    return [];
  }

  function safeGetCategoriesFromResponse(res) {
    if (!res) return [];
    if (Array.isArray(res)) return res;
    if (res.categories && Array.isArray(res.categories)) return res.categories;
    if (res.data && Array.isArray(res.data)) return res.data;
    for (const k of Object.keys(res)) {
      if (Array.isArray(res[k])) return res[k];
    }
    return [];
  }

  async function loadCategories() {
    categoriesDiv.innerHTML = '<div class="spinner"></div>';
    try {
      const resp = await fetch("https://openapi.programming-hero.com/api/categories");
      const json = await resp.json();
      const cats = safeGetCategoriesFromResponse(json);

      categoriesDiv.innerHTML = "";
      const allBtn = document.createElement("button");
      allBtn.textContent = "All Trees";
      allBtn.className = "px-4 py-2 rounded hover:bg-green-100 text-left active-category";
      allBtn.onclick = () => {
        activeCategoryId = null;
        setActiveButton(allBtn);
        loadTrees();
      };
      categoriesDiv.appendChild(allBtn);
      setActiveButton(allBtn);

      if (cats.length === 0) {
        const fallback = ["Fruit Trees","Flowering Trees","Shade Trees","Medicinal Trees"];
        fallback.forEach((name, idx) => {
          const btn = document.createElement("button");
          btn.textContent = name;
          btn.className = "px-4 py-2 rounded hover:bg-green-100 text-left";
          btn.onclick = () => {
            activeCategoryId = idx + 1;
            setActiveButton(btn);
            loadTrees();
          };
          categoriesDiv.appendChild(btn);
        });
        return;
      }

      cats.forEach(cat => {
        const id = cat.category_id ?? cat.id ?? cat._id ?? cat.categoryId ?? cat.category_id;
        const label = cat.category ?? cat.name ?? cat.category_name ?? cat;
        const btn = document.createElement("button");
        btn.textContent = label;
        btn.className = "px-4 py-2 rounded hover:bg-green-100 text-left";
        btn.onclick = () => {
          activeCategoryId = id ?? label;
          setActiveButton(btn);
          loadTrees();
        };
        categoriesDiv.appendChild(btn);
      });

    } catch (err) {
      categoriesDiv.innerHTML = "<p class='text-red-600'>Failed to load categories</p>";
      console.error("Categories load error:", err);
    }
  }

  function setActiveButton(btn) {
    if (activeCategoryButton) activeCategoryButton.classList.remove("active-category");
    activeCategoryButton = btn;
    activeCategoryButton.classList.add("active-category");
  }

  async function loadTrees() {
    treeList.innerHTML = '<div class="col-span-full flex justify-center py-6"><div class="spinner"></div></div>';
    try {
      let url;
      if (activeCategoryId) {
        url = `https://openapi.programming-hero.com/api/category/${encodeURIComponent(activeCategoryId)}`;
      } else {
        url = "https://openapi.programming-hero.com/api/plants";
      }

      const resp = await fetch(url);
      const json = await resp.json();
      const plants = safeGetPlantsFromResponse(json);

      if (!plants || plants.length === 0) {
        treeList.innerHTML = "<p class='col-span-full text-center text-gray-600'>No plants found.</p>";
        return;
      }

      treeList.innerHTML = "";
      plants.forEach(p => {
        const id = p.id ?? p._id ?? p.plant_id ?? p.plantId ?? p.id;
        const name = p.name ?? p.plant_name ?? p.title ?? "Unnamed";
        const shortDesc = p.short_description ?? p.shortDescription ?? p.description?.slice?.(0,120) ?? (p.description ? (p.description.slice(0,120)+"...") : "No description available.");
        const fullDesc = p.description ?? p.full_description ?? p.details ?? "";
        const category = p.category ?? p.category_name ?? p.cat ?? (p.categories ? (Array.isArray(p.categories) ? p.categories.join(", ") : p.categories) : "Uncategorized");
        const price = (p.price ?? p.cost ?? p.amount ?? 0);
        let image = p.image ?? p.img ?? p.image_url ?? p.images?.[0] ?? null;
        if (!image && p.photos && Array.isArray(p.photos) && p.photos[0]) image = p.photos[0];
        if (!image) image = PLACEHOLDER_IMG;

        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded-lg shadow flex flex-col";

        card.innerHTML = `
          <div class="h-40 mb-3 rounded overflow-hidden flex items-center justify-center bg-gray-100">
            <img src="${image}" alt="${escapeHtml(name)}" class="h-full w-full object-cover" onerror="this.src='${PLACEHOLDER_IMG}'" />
          </div>
          <h3 class="font-semibold text-gray-800 mb-1 cursor-pointer">${escapeHtml(name)}</h3>
          <p class="text-sm text-gray-600 mb-3">${escapeHtml(shortDesc)}</p>
          <div class="flex justify-between items-center mb-3">
            <span class="category-badge">${escapeHtml(category)}</span>
            <p class="font-bold text-gray-800">à§³${escapeHtml(price)}</p>
          </div>
          <button class="bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded-full font-semibold w-full mt-auto">Add to Cart</button>
        `;

        card.querySelector("h3").addEventListener("click", () => openModalByData({
          id, name, image, description: fullDesc || shortDesc, price, category
        }));
        card.querySelector("button").addEventListener("click", () => addToCart({
          id, name, price, image
        }));

        treeList.appendChild(card);
      });

    } catch (err) {
      treeList.innerHTML = "<p class='col-span-full text-red-600'>Failed to load plants</p>";
      console.error("Plants load error:", err);
    }
  }

  function addToCart(item) {
    cart.push(item);
    renderCart();
  }

  function renderCart() {
    cartList.innerHTML = "";
    let total = 0;
    cart.forEach((item, index) => {
      total += Number(item.price) || 0;
      const li = document.createElement("li");
      li.className = "flex justify-between items-center bg-white p-2 rounded shadow";
      li.innerHTML = `
        <div class="flex items-center gap-2">
          <img src="${item.image}" class="w-10 h-10 object-cover rounded" onerror="this.src='${PLACEHOLDER_IMG}'"/>
          <span>${escapeHtml(item.name)}</span>
        </div>
        <button class="text-red-600">âœ•</button>
      `;
      li.querySelector("button").onclick = () => {
        cart.splice(index,1);
        renderCart();
      };
      cartList.appendChild(li);
    });
    cartTotal.textContent = total.toFixed(2);
  }

  function openModalByData(p) {
    modalTitle.textContent = p.name;
    modalDesc.textContent = p.description;
    modalPrice.textContent = p.price;
    modalImg.src = p.image || PLACEHOLDER_IMG;
    modalCategory.textContent = "Category: " + (p.category || "Uncategorized");
    modal.classList.remove("hidden");
  }

  function closeModal() {
    modal.classList.add("hidden");
  }

  function escapeHtml(str) {
    if (!str) return "";
    return str.toString()
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  loadCategories();
  loadTrees();
</script>
</body>
</html>
